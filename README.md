# Transit Web Table

Веб-приложение для отображения таблицы заказов с возможностью сортировки, фильтрации и цветового выделения строк по времени обработки.

## Функциональность

- 📊 **Таблица заказов** с данными из Supabase
- 🔐 **Аутентификация** (вход/регистрация)
- 🔄 **Сортировка** по любому столбцу
- 🎨 **Цветовое выделение** строк по времени обработки
- 📱 **Адаптивный дизайн** для мобильных устройств
- 🖱️ **Drag & Drop** для изменения порядка колонок
- 📄 **Пагинация** с настройкой количества строк на странице
- ⚡ **Быстрая загрузка** с состояниями загрузки и ошибок

## Структура проекта

```
transit-web-table/
├── app/                    # Next.js App Router
│   ├── layout.tsx         # Корневой layout с контекстом приложения
│   ├── page.tsx           # Главная страница
│   ├── login/             # Страница входа
│   └── globals.css        # Глобальные стили
├── components/            # React компоненты
│   ├── auth/              # Компоненты аутентификации
│   │   └── LoginForm.tsx        # Форма входа
│   ├── DraggableColumnHeader.tsx    # Перетаскиваемый заголовок колонки
│   ├── ErrorState.tsx               # Состояние ошибки
│   ├── HighlightToggle.tsx          # Переключатель выделения
│   ├── Instructions.tsx             # Инструкции для пользователя
│   ├── LoadingState.tsx             # Состояние загрузки
│   └── TablePagination.tsx          # Компонент пагинации
├── contexts/              # React контексты
│   └── AppContext.tsx     # Глобальный контекст приложения
├── hooks/                 # React хуки
│   ├── useOrders.ts       # Хук для загрузки заказов
│   └── useOrderTable.ts   # Хук для управления состоянием таблицы
├── lib/                   # Утилиты и конфигурация
│   ├── config.ts          # Конфигурационные константы
│   ├── orderUtils.ts      # Утилиты для работы с заказами
│   ├── supabase/          # Конфигурация Supabase
│   │   ├── server.ts      # Серверный клиент Supabase
│   │   └── index.ts       # Клиентский клиент Supabase
│   ├── tableColumns.ts    # Определение колонок таблицы
│   └── timeUtils.ts       # Утилиты для работы с временем
├── types/                 # TypeScript типы
│   └── database.ts        # Типы базы данных
└── public/               # Статические файлы
```

## Модули

### 🎯 Компоненты (`components/`)

#### `auth/LoginForm.tsx`
Форма входа в систему с валидацией полей.

**Функции:**
- Валидация email и пароля
- Обработка ошибок входа
- Перенаправление после успешного входа

#### `DraggableColumnHeader.tsx`
Перетаскиваемый заголовок колонки с поддержкой drag & drop.

**Props:**
- `header: Header<Order, unknown>` - объект заголовка из TanStack Table

#### `HighlightToggle.tsx`
Переключатель для включения/отключения цветового выделения строк.

**Props:**
- `enabled: boolean` - состояние включения
- `onToggle: (enabled: boolean) => void` - обработчик переключения

#### `TablePagination.tsx`
Компонент пагинации с мобильной и десктопной версиями.

**Props:**
- `table: Table<Order>` - экземпляр таблицы TanStack

#### `LoadingState.tsx`
Компонент состояния загрузки с анимированным спиннером.

#### `ErrorState.tsx`
Компонент состояния ошибки с кнопкой повтора.

**Props:**
- `error: string` - текст ошибки
- `onRetry: () => void` - обработчик повтора

#### `Instructions.tsx`
Компонент с инструкциями для пользователя.

### 🌐 Контексты (`contexts/`)

#### `AppContext.tsx`
Глобальный контекст приложения, содержащий:
- Состояние выделения по времени
- Диапазон дат для фильтрации
- Состояние отображения аналитики
- Выбранное подразделение
- Информация о пользователе

### 🛠️ Утилиты (`lib/`)

#### `config.ts`
Конфигурационные константы приложения:
- Настройки пагинации
- Пороговые значения времени
- Форматы дат

#### `orderUtils.ts`
Утилиты для работы с заказами:
- Валидация и нормализация данных заказов

#### `timeUtils.ts`
Утилиты для работы с временем обработки заказов.

**Экспорты:**
- `parseProcessingTime(time: string | null): number` - парсинг времени в минуты
- `getRowColor(processingTime: string | null, highlightEnabled: boolean): string` - определение цвета строки
- `TIME_THRESHOLDS` - константы пороговых значений
- `filterOrdersByDateRange(orders: Order[], dateRange: DateRange): Order[]` - фильтрация по датам

**Поддерживаемые форматы времени:**
- `"Xч Yмин"` - часы и минуты
- `"Xч"` - только часы
- `"Yмин"` - только минуты
- `"X Y"` - числа (первое - часы, второе - минуты)

#### `tableColumns.ts`
Определение колонок таблицы и их конфигурации.

**Экспорты:**
- `columns` - массив определений колонок
- `initialColumnOrder` - начальный порядок колонок

### 🎣 Хуки (`hooks/`)

#### `useOrders.ts`
Хук для загрузки данных заказов из Supabase с валидацией.

**Возвращает:**
- `orders: Order[]` - массив заказов
- `loading: boolean` - состояние загрузки
- `error: string | null` - ошибка загрузки
- `refetch: () => void` - функция повторной загрузки

#### `useOrderTable.ts`
Хук для управления состоянием таблицы TanStack с фильтрацией.

**Возвращает:**
- `table` - экземпляр таблицы TanStack
- `sorting, pagination, columnOrder` - состояния таблицы
- `setSorting, setPagination, setColumnOrder` - сеттеры для состояний
- `filteredOrders` - отфильтрованные заказы

## Цветовое выделение

При включенном переключателе строки выделяются цветом в зависимости от времени обработки:

- 🟡 **Желтый** (20-30 минут) - предупреждение
- 🔴 **Красный** (>30 минут) - критическое время
- ⚪ **Обычный** (<20 минут) - нормальное время

## Технологии

- **Next.js 15** - React фреймворк
- **TanStack Table** - библиотека для таблиц
- **@dnd-kit** - drag & drop функциональность
- **Supabase** - база данных и API
- **react-hook-form** - управление формами
- **TypeScript** - типизация
- **Tailwind CSS** - стилизация

## Установка и запуск

1. Клонируйте репозиторий
2. Установите зависимости: `npm install`
3. Настройте переменные окружения для Supabase:
   - Скопируйте `.env.local.example` в `.env.local`
   - Заполните переменные окружения данными из панели управления Supabase
4. Запустите разработку: `npm run dev`
5. Откройте [http://localhost:3000](http://localhost:3000)

## Сборка

```bash
npm run build
npm start
```

## Разработка

Код организован в модульную структуру для легкого сопровождения и расширения:

- **Компоненты** вынесены в отдельные файлы для переиспользования
- **Утилиты** централизованы в `lib/` для единообразия
- **Типы** строго типизированы для безопасности
- **Хуки** инкапсулируют логику работы с данными
- **Контексты** управляют глобальным состоянием приложения

## Возможные улучшения

- [ ] Добавить фильтрацию по подразделениям
- [ ] Реализовать экспорт данных
- [ ] Добавить графики и аналитику
- [ ] Реализовать поиск по таблице
- [ ] Добавить темную тему
